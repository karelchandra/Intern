<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="theme-color" content="#000000">
    <meta name="name" content="Sales Report">

    <title>Sales Report 2021-2020</title>
    <!-- <link rel="icon" type="image/x-icon" href="./favicon.png"> -->

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css" type="text/css" />
    <link rel="stylesheet" href="https://unpkg.com/@holoviz/panel@0.13.1/dist/css/widgets.css" type="text/css" />
    <link rel="stylesheet" href="https://unpkg.com/@holoviz/panel@0.13.1/dist/css/markdown.css" type="text/css" />

    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/vega@5.22.1"></script>
    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/vega-lite@5.5.0"></script>
    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/vega-embed@6.21.0"></script>
    <script type="text/javascript" src="https://unpkg.com/tabulator-tables@4.9.3/dist/js/tabulator.js"></script>
    <script type="text/javascript" src="https://cdn.bokeh.org/bokeh/release/bokeh-2.4.3.js"></script>
    <script type="text/javascript" src="https://cdn.bokeh.org/bokeh/release/bokeh-widgets-2.4.3.min.js"></script>
    <script type="text/javascript" src="https://cdn.bokeh.org/bokeh/release/bokeh-tables-2.4.3.min.js"></script>
    <script type="text/javascript" src="https://unpkg.com/@holoviz/panel@0.13.1/dist/panel.min.js"></script>
    <script type="text/javascript">
      Bokeh.set_log_level("info");
    </script>

    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://unpkg.com/@holoviz/panel@0.13.1/dist/bundled/bootstraptemplate/bootstrap.css">
    <link rel="stylesheet" href="https://unpkg.com/@holoviz/panel@0.13.1/dist/bundled/defaulttheme/default.css">
    <link rel="stylesheet" href="https://www.w3schools.com/w3css/4/w3.css">
    <link rel="stylesheet" href="https://www.w3schools.com/lib/w3-theme-black.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">

    <script src="https://cdn.jsdelivr.net/npm/jquery@3.5.1/dist/jquery.slim.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/js/bootstrap.bundle.min.js"></script>

    <link rel="stylesheet" href="https://pyscript.net/latest/pyscript.css" />
    <script defer src="https://pyscript.net/latest/pyscript.js"></script>
  </head>
  <py-config>
    packages = [
      "altair",
      "pandas",
      "numpy",
      "scikit-learn",
      "panel==0.13.1",
      "matplotlib"
    ]
  </py-config>
  <body>

    <div class="container-fluid d-flex flex-column vh-100 overflow-hidden" id="container">
      <!-- Side Navigation and Header -->
      <nav class="navbar navbar-expand-md navbar-dark sticky-top shadow w3-blue-grey" id="header">
	
	<div class="app-header">
	  <a class="w3-xlarge navbar-brand app-logo" href="/">
	    <img src="https://github.com/karelchandra/Intern/blob/main/Pro_Health.png?raw=true" class="app-logo" width = "100" height = "3000">
	  </a>
	  <a class="title" href="" style="color: #efebe3;">Report Analysis</a>
      </div>
      </nav>
  

	<div class="col mh-100 float-left w3-display-container" id="main">

    <!-- Header -->
  <div class="w3-container-padding-small" style="margin-top:15px" id="showcase">
    <h2 class="w3-xxxlarge" style = "font-weight: bold" id="title"></h2>
    <h1 class="w3-xxlarge w3-text-teal w3-padding-small" style = "font-weight: bold" id="subtitle"></h1>
  </div>

    <h3 class="w3-xlarge w3-text-teal w3-padding-small" style = "font-weight: bold" id="Ax_des"></h3>
    <header style="font-size:30px;" class="w3-container w3-blue-grey w3-padding-small" id = 'sph_des'>
    </header>
	  <div class = "box">
      <div class="bk-root" style="margin-top:10px; margin-left: 3%;" id="bar-plot2"></div>
      <div class="bk-root" style="margin-top:10px; margin-left: 42%;" id="bar-plot4"></div>
    </div>

    <header style="font-size:30px;" class="w3-container w3-blue-grey w3-padding-small" id="value_des">
    </header>
    <div class = "box">
      <div class="bk-root" style="margin-top:10px; margin-left: 2%;" id="bar-plot1"></div>
      <div class="bk-root" style="margin-top:10px; margin-left: 41%;" id="bar-plot3"></div>
    </div>
	  
    <h3 class="w3-xlarge w3-text-teal w3-padding-small" style = "font-weight: bold" id="Al_des"></h3>

    <header style="font-size:30px;" class="w3-container w3-blue-grey w3-padding-small" id = 'spha_des'>
    </header>
	  <div class = "box">
      <div class="bk-root" style="margin-top:10px; margin-left: 3%;" id="bar-plot6"></div>
      <div class="bk-root" style="margin-top:10px; margin-left: 42%;" id="bar-plot8"></div>
    </div>

    <header style="font-size:30px;" class="w3-container w3-blue-grey w3-padding-small" id="valuea_des">
    </header>
    <div class = "box">
      <div class="bk-root" style="margin-top:10px; margin-left: 2%;" id="bar-plot5"></div>
      <div class="bk-root" style="margin-top:10px; margin-left: 41%;" id="bar-plot7"></div>
    </div>

    <header style="font-size:30px;" class="w3-container w3-blue-grey w3-padding-small" id="table_des">
    </header>
    <h4 class="w3-large w3-text-teal w3-padding-small" style = "font-weight: bold" id="AxS_data"></h3>
    <div class="bk-root" id="Axs_table"></div>
    <h4 class="w3-large w3-text-teal w3-padding-small" style = "font-weight: bold" id="AxI_data"></h3>
    <div class="bk-root" id="Axi_table"></div>
    <h4 class="w3-large w3-text-teal w3-padding-small" style = "font-weight: bold" id="AlS_data"></h3>
    <div class="bk-root" id="Als_table"></div>
    <h4 class="w3-large w3-text-teal w3-padding-small" style = "font-weight: bold" id="AlI_data"></h3>
    <div class="bk-root" id="Ali_table"></div>
	</div>
      </div>
    </div>

    

    <py-script>
      import warnings
      import altair as alt
      import panel as pn
      import pandas as pd
      pn.extension('vega')

      from pyodide.http import open_url

      warnings.simplefilter(action='ignore', category=FutureWarning)
      pn.config.sizing_mode = 'stretch_width'

      df1 = pd.read_csv(open_url('https://raw.githubusercontent.com/karelchandra/Intern/main/sales2021-2022AXELIA-SET.csv'), sep=";")
      df1.name = 'set'
      df2 = pd.read_csv(open_url('https://raw.githubusercontent.com/karelchandra/Intern/main/sales2021-2022AXELIA-ITEM.csv'), sep=";")
      df2.name = 'item'
      df3 = pd.read_csv(open_url('https://raw.githubusercontent.com/karelchandra/Intern/main/sales2021-2022ALLIED-SET.csv'), sep=";")
      df3.name = 'set'
      df4 = pd.read_csv(open_url('https://raw.githubusercontent.com/karelchandra/Intern/main/sales2021-2022ALLIED-ITEM.csv'), sep=";")
      df4.name = 'item'
      
      button = pn.widgets.Button(name='Most Sales', button_type='primary').servable(target='button-widget')
      Axs_table = pn.widgets.Tabulator(pagination='remote', page_size=5).servable(target='Axs_table')
      Axi_table = pn.widgets.Tabulator(pagination='remote', page_size=5).servable(target='Axi_table')
      Als_table = pn.widgets.Tabulator(pagination='remote', page_size=5).servable(target='Als_table')
      Ali_table = pn.widgets.Tabulator(pagination='remote', page_size=5).servable(target='Ali_table')
      bar_vs = pn.pane.Vega().servable(target='bar-plot1')
      bar_sps = pn.pane.Vega().servable(target='bar-plot2')
      bar_vi = pn.pane.Vega().servable(target='bar-plot3')
      bar_spi = pn.pane.Vega().servable(target='bar-plot4')
      bar_vsal = pn.pane.Vega().servable(target='bar-plot5')
      bar_spsal = pn.pane.Vega().servable(target='bar-plot6')
      bar_vial = pn.pane.Vega().servable(target='bar-plot7')
      bar_spial = pn.pane.Vega().servable(target='bar-plot8')

      title = pn.pane.Markdown("""Annual Sales Report""").servable(target='title')
      subtitle = pn.pane.Markdown("""2021-2022""").servable(target='subtitle')
      sph_des = pn.pane.Markdown("""Analysis of No.SPH made per Month""").servable(target='sph_des')
      value_des = pn.pane.Markdown("""Analysis of Successful Transactions per Month""").servable(target='value_des')
      table_des = pn.pane.Markdown("""Provided Dataset""").servable(target='table_des')
      Ax_des = pn.pane.Markdown("""Axelia""").servable(target='Ax_des')
      Al_des = pn.pane.Markdown("""Allied""").servable(target='Al_des')
      spha_des = pn.pane.Markdown("""Analysis of No.SPH made per Month""").servable(target='spha_des')
      valuea_des = pn.pane.Markdown("""Analysis of Successful Transactions per Month""").servable(target='valuea_des')
      AxS_data = pn.pane.Markdown("""Axelia-SET Dataset""").servable(target='AxS_data')
      AxI_data = pn.pane.Markdown("""Axelia-ITEM Dataset""").servable(target='AxI_data')
      AlS_data = pn.pane.Markdown("""Allied-SET Dataset""").servable(target='AlS_data')
      AlI_data = pn.pane.Markdown("""Allied-ITEM Dataset""").servable(target='AlI_data')
      
      selection = alt.selection_single(fields=['PS'], bind='legend')
      selector = alt.selection_single(fields=['PS'])
      
      def get_bar_sph(df):
          Ax_copy = df.copy()
          Ax_copy['tgl'] = pd.to_datetime(Ax_copy['tgl'])
          Ax_copy.rename(columns = {'No.SPH':'No_SPH'}, inplace = True)
          Ax_set_sph = Ax_copy.groupby([Ax_copy['tgl'].dt.to_period('M'), Ax_copy['PS']])['No_SPH'].count()
          Ax_set_sph = Ax_set_sph.reset_index()  
          Ax_set_sph['tgl'] = Ax_set_sph['tgl'].dt.to_timestamp('s').dt.strftime('%Y-%m')
          if df.name == "set":
            return(
              alt.Chart(Ax_set_sph)
              .mark_bar()
              .encode(
                y='No_SPH',
                color= alt.Color('PS', legend=alt.Legend(symbolLimit=90)),
                x='tgl',
                tooltip=['No_SPH', 'PS'],
                order = alt.Order(
                  'No_SPH',
                  sort = 'ascending'
                )
              )
              .properties(
                height=600, width=500, title="Set Chart"
              )
              .add_selection(
                selection,
                selector
              )
              .transform_filter(
                selection&selector
              )
            )
          else:
            return(
              alt.Chart(Ax_set_sph)
              .mark_bar()
              .encode(
                y='No_SPH',
                color= alt.Color('PS', legend=alt.Legend(symbolLimit=90)),
                x='tgl',
                tooltip=['No_SPH', 'PS'],
                order = alt.Order(
                  'No_SPH',
                  sort = 'ascending'
                )
              ) 
              .properties(
                height=600, width=500, title="Item Chart"
              )
              .add_selection(
                selection,selector
              )
              .transform_filter(
                selection&selector
              )
            )
      
      def get_bar_value(df):
          Ax_copy = df.copy()
          Ax_copy['tgl'] = pd.to_datetime(Ax_copy['tgl'])
          Ax_set_m = Ax_copy.groupby([Ax_copy['tgl'].dt.to_period('M'), Ax_copy['PS']])['Value'].sum()
          Ax_set_m = Ax_set_m.reset_index()     
          Ax_set_m['tgl'] = Ax_set_m['tgl'].dt.to_timestamp('s').dt.strftime('%Y-%m')
          if df.name == "set":
            return(
              alt.Chart(Ax_set_m)
              .mark_bar()
              .encode(
                y='Value',
                color= alt.Color('PS', legend=alt.Legend(symbolLimit=90)),
                x='tgl',
                tooltip=[alt.Tooltip('Value',format=",.2f"), 'PS'],
                order = alt.Order(
                  'Value',
                  sort = 'ascending'
                )
              )
              .properties(
                height=600, width=500, title="Set Chart"
              )
              .add_selection(
                selection, selector
              )
              .transform_filter(
                selection&selector
              )
            )
          else:
            return(
              alt.Chart(Ax_set_m)
              .mark_bar()
              .encode(
                y='Value',
                color= alt.Color('PS', legend=alt.Legend(symbolLimit=90)),
                x='tgl',
                tooltip=[alt.Tooltip('Value',format=",.2f"), 'PS'],
                order = alt.Order(
                  'Value',
                  sort = 'ascending'
                )
              )
              .properties(
                height=600, width=500, title="Item Chart"
              )
              .add_selection(
                selection, selector
              )
              .transform_filter(
                selection&selector
              )
            )

      bar_sps.object = get_bar_sph(df1)
      bar_spi.object = get_bar_sph(df2)
      bar_vs.object = get_bar_value(df1)
      bar_vi.object = get_bar_value(df2)
      bar_spsal.object = get_bar_sph(df3)
      bar_spial.object = get_bar_sph(df4)
      bar_vsal.object = get_bar_value(df3)
      bar_vial.object = get_bar_value(df4)
      Axs_table.value=df1
      Axi_table.value=df2
      Als_table.value=df3
      Ali_table.value=df4

      
    </py-script>

  </body>
  
</html>
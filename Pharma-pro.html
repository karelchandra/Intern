<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="theme-color" content="#000000">
    <meta name="name" content="Report Based On Operational">

    <title>Shipping Report 2022-2023</title>
    <!-- <link rel="icon" type="image/x-icon" href="./favicon.png"> -->

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css" type="text/css" />
    <link rel="stylesheet" href="https://unpkg.com/@holoviz/panel@0.13.1/dist/css/widgets.css" type="text/css" />
    <link rel="stylesheet" href="https://unpkg.com/@holoviz/panel@0.13.1/dist/css/markdown.css" type="text/css" />

    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/vega@5.22.1"></script>
    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/vega-lite@5.5.0"></script>
    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/vega-embed@6.21.0"></script>
    <script type="text/javascript" src="https://unpkg.com/tabulator-tables@4.9.3/dist/js/tabulator.js"></script>
    <script type="text/javascript" src="https://cdn.bokeh.org/bokeh/release/bokeh-2.4.3.js"></script>
    <script type="text/javascript" src="https://cdn.bokeh.org/bokeh/release/bokeh-widgets-2.4.3.min.js"></script>
    <script type="text/javascript" src="https://cdn.bokeh.org/bokeh/release/bokeh-tables-2.4.3.min.js"></script>
    <script type="text/javascript" src="https://unpkg.com/@holoviz/panel@0.13.1/dist/panel.min.js"></script>
    <script type="text/javascript">
      Bokeh.set_log_level("info");
    </script>

    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://unpkg.com/@holoviz/panel@0.13.1/dist/bundled/bootstraptemplate/bootstrap.css">
    <link rel="stylesheet" href="https://unpkg.com/@holoviz/panel@0.13.1/dist/bundled/defaulttheme/default.css">
    <link rel="stylesheet" href="https://www.w3schools.com/w3css/4/w3.css">
    <link rel="stylesheet" href="https://www.w3schools.com/lib/w3-theme-black.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">

    <style>
      #sidebar {
        width: 350px;
      }
      .w3-sidebar {
        z-index: 3;
        width: 250px;
        top: 43px;
        bottom: 0;
        height: inherit; 
      }
      .box div {
        width: 100px;
        display: inline-block;
        padding: 1rem 1rem;
        vertical-align: middle;
      }


    </style>

    <script src="https://cdn.jsdelivr.net/npm/jquery@3.5.1/dist/jquery.slim.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/js/bootstrap.bundle.min.js"></script>

    <link rel="stylesheet" href="https://pyscript.net/latest/pyscript.css" />
    <script defer src="https://pyscript.net/latest/pyscript.js"></script>
  </head>

  <py-config>
    packages = [
      "altair",
      "pandas",
      "numpy",
      "scikit-learn",
      "panel==0.13.1",
      "matplotlib"
    ]
  </py-config>
  
  <body>

    <div class="container-fluid d-flex flex-column vh-100 overflow-hidden" id="container">
        <!-- Side Navigation and Header -->
        <nav class="navbar navbar-expand-md navbar-dark sticky-top shadow w3-blue-grey" id="header">
      
        <div class="app-header">
          <a class="w3-xlarge navbar-brand app-logo" href="/">
          <img src="https://github.com/karelchandra/Intern/blob/main/Pro_Health.png?raw=true" class="app-logo" width = "100" height = "3000">
          </a>
        <a class="title" href="" style="color: #efebe3;">Report Analysis</a>
        </div>
        </nav>

	  <div class="col mh-100 float-left w3-display-container" id="main">

    <!-- Header -->
    <div class="w3-container-padding-small" style="margin-top:15px" id="showcase">
      <h2 class="w3-xxxlarge" style = "font-weight: bold" id="title"></h2>
      <h1 class="w3-xxlarge w3-text-teal w3-padding-small" style = "font-weight: bold" id="subtitle"></h1>
    </div>

    <header style="font-size:30px;" class="w3-container w3-blue-grey w3-padding-small" id="qty_des">
    </header>
    <div class = "box">
        <div class="bk-root" style="margin-top:10px; margin-left: 5%;" id="bar-plot1"></div>
        <div class="bk-root" style="margin-top:10px; margin-left: 43%;" id="bar-plot4"></div>
      </div>
    
    <header style="font-size:30px;" class="w3-container w3-blue-grey w3-padding-small" id ="per_des">
    </header>
    <div class = "box">
        <div class="bk-root" style="margin-top:10px; margin-left: 5%;" id="bar-plot2"></div>
        <div class="bk-root" style="margin-top:10px; margin-left: 43%;" id="bar-plot5"></div>
      </div>
    
    <header style="font-size:30px;" class="w3-container w3-blue-grey w3-padding-small" id ="pal_des">
    </header>
    <div class = "box">
        <div class="bk-root" style="margin-top:10px; margin-left: 5%;" id="bar-plot3"></div>
        <div class="bk-root" style="margin-top:10px; margin-left: 43%;" id="bar-plot6"></div>
      </div>
    
    <header style="font-size:30px;" class="w3-container w3-blue-grey w3-padding-small" id="table_des">
    </header>
    <h4 class="w3-large w3-text-teal w3-padding-small" style = "font-weight: bold" id="ASMIUA_des"></h3>
    <div class="bk-root" id="ASMIUA_table"></div>
    
    <h4 class="w3-large w3-text-teal w3-padding-small" style = "font-weight: bold" id="PDSKJI_des"></h3>
    <div class="bk-root" id="PDSKJI_table"></div>

    <h4 class="w3-large w3-text-teal w3-padding-small" style = "font-weight: bold" id="PERAPI_des"></h3>
    <div class="bk-root" id="PERAPI_table"></div>
    
        
    <py-script>
      import warnings
      import altair as alt
      import panel as pn
      import pandas as pd
      from io import BytesIO
      import requests as rq
          
      pn.extension('vega')
    
      from pyodide.http import open_url
    
      warnings.simplefilter(action='ignore', category=FutureWarning)
      pn.config.sizing_mode = 'stretch_width'

      ASMIUA_table = pn.widgets.Tabulator(pagination='remote', page_size=5).servable(target='ASMIUA_table')
      PDSKJI_table = pn.widgets.Tabulator(pagination='remote', page_size=5).servable(target='PDSKJI_table')
      PERAPI_table = pn.widgets.Tabulator(pagination='remote', page_size=5).servable(target='PERAPI_table')
      
      
      bar_A = pn.pane.Vega().servable(target='bar-plot1')
      bar_PD = pn.pane.Vega().servable(target='bar-plot2')
      bar_PE = pn.pane.Vega().servable(target='bar-plot3')
      bar_AS = pn.pane.Vega().servable(target='bar-plot4')
      bar_PDs = pn.pane.Vega().servable(target='bar-plot5')
      bar_PEs = pn.pane.Vega().servable(target='bar-plot6')
      
      title = pn.pane.Markdown("""Pharma Pro Report""").servable(target='title')
      subtitle = pn.pane.Markdown("""2022""").servable(target='subtitle')
      table_des = pn.pane.Markdown("""Provided Dataset""").servable(target='table_des')
      ASMIUA_data = pn.pane.Markdown("""ASMIUA Dataset""").servable(target='ASMIUA_des')
      PDSKJI_data = pn.pane.Markdown("""PDSKJI Dataset""").servable(target='PDSKJI_des')
      PERAPI_data = pn.pane.Markdown("""PERAPI Dataset""").servable(target='PERAPI_des')
      
      qty_des = pn.pane.Markdown("""Analysis of ASMIUA Event""").servable(target='qty_des')
      per_des = pn.pane.Markdown("""Analysis of PDSKJI Event""").servable(target='per_des')
      pal_des = pn.pane.Markdown("""Analysis of PERAPI Event""").servable(target='pal_des')
     
      
      df_ASMIUA = pd.read_csv(open_url('https://raw.githubusercontent.com/karelchandra/Intern/main/ASMIUA.csv'), low_memory=False)
      df_ASMIUA.name = 'A'
      df_ASMIUA.columns = df_ASMIUA.columns.str.replace(' ', '_')
      df_ASMIUA.columns = df_ASMIUA.columns.str.replace('.', '_')
      df_ASMIUA['Tgl_Registrasi'] = pd.to_datetime(df_ASMIUA['Tgl_Registrasi'])
      df_ASMIUA['Kode'] = df_ASMIUA['Kode_Peserta'].copy()
      
      df_PDSKJI = pd.read_csv(open_url('https://raw.githubusercontent.com/karelchandra/Intern/main/PDSKJI.csv'), low_memory=False)
      df_PDSKJI.name = 'PD'
      df_PDSKJI.columns = df_PDSKJI.columns.str.replace(' ', '_')
      df_PDSKJI.columns = df_PDSKJI.columns.str.replace('.', '_')
      df_PDSKJI['Tgl_Registrasi'] = pd.to_datetime(df_PDSKJI['Tgl_Registrasi'])
      df_PDSKJI['Kode'] = df_PDSKJI['Kode_Peserta'].copy()

      df_PERAPI = pd.read_csv(open_url('https://raw.githubusercontent.com/karelchandra/Intern/main/PERAPI.csv'), low_memory=False)
      df_PERAPI.name = 'PE'
      df_PERAPI.columns = df_PERAPI.columns.str.replace(' ', '_')
      df_PERAPI.columns = df_PERAPI.columns.str.replace('.', '_')
      df_PERAPI['Tgl_Registrasi'] = pd.to_datetime(df_PERAPI['Tgl_Registrasi'])
      df_PERAPI['Kode'] = df_PERAPI['Kode_Peserta'].copy()

      selection = alt.selection_single(fields=['Jenis_Registrasi'], bind='legend')
      selector = alt.selection_single(fields=['Jenis_Registrasi'])

      selections = alt.selection_single(fields=['Status_Pembayaran'], bind='legend')
      selectors = alt.selection_single(fields=['Status_Pembayaran'])
      
      def get_bar_(df):
          A_copy = df.copy()
          A_m = A_copy.groupby([A_copy['Tgl_Registrasi'],A_copy['Kode_Peserta'],A_copy['Nama_Peserta'],A_copy['Jenis_Registrasi']])['Kode'].count()
          A_m = A_m.reset_index()
          if df.name == "A":
            return(
                alt.Chart(A_m)
                .mark_bar()
                .encode(
                y='Kode',
                x='Tgl_Registrasi',
                color = 'Jenis_Registrasi',
                tooltip=['Tgl_Registrasi','Jenis_Registrasi', 'Kode_Peserta', 'Nama_Peserta'],
                order = alt.Order(
                    'Jenis_Registrasi',
                    sort = 'ascending'
                    )
                )
                .properties(
                height=600, width=500, title='Jenis Registrasi ASMIUA'
                )
                .add_selection(
                selection, selector
                )
                .transform_filter(
                selection&selector
                ) 
            )
          elif df.name == "PD":
            return(
                alt.Chart(A_m)
                .mark_bar()
                .encode(
                y='Kode',
                x='Tgl_Registrasi',
                color = 'Jenis_Registrasi',
                tooltip=['Tgl_Registrasi','Jenis_Registrasi', 'Kode_Peserta', 'Nama_Peserta'],
                order = alt.Order(
                    'Jenis_Registrasi',
                    sort = 'ascending'
                    )
                )
                .properties(
                    height=600, width=500, title='Jenis Registrasi PDSKJI'
                )
                .add_selection(
                    selection, selector
                )
                .transform_filter(
                    selection&selector
                ) 
            )
          else:
            return(
                alt.Chart(A_m)
                .mark_bar()
                .encode(
                y='Kode',
                x='Tgl_Registrasi',
                color = 'Jenis_Registrasi',
                tooltip=['Tgl_Registrasi','Jenis_Registrasi', 'Kode_Peserta', 'Nama_Peserta'],
                order = alt.Order(
                    'Jenis_Registrasi',
                    sort = 'ascending'
                    )
                )
                .properties(
                    height=600, width=500, title='Jenis Registrasi PERAPI'
                )
                .add_selection(
                    selection, selector
                )
                .transform_filter(
                    selection&selector
                ) 
            )

      def get_bar_s(df):
          A_copy = df.copy()
          A_m = A_copy.groupby([A_copy['Tgl_Registrasi'],A_copy['Kode_Peserta'],A_copy['Nama_Peserta'],A_copy['Status_Pembayaran']])['Kode'].count()
          A_m = A_m.reset_index()
          if df.name == "A":
            return(
                alt.Chart(A_m)
                .mark_bar()
                .encode(
                y='Kode',
                x='Tgl_Registrasi',
                color = 'Status_Pembayaran',
                tooltip=['Tgl_Registrasi','Status_Pembayaran', 'Kode_Peserta', 'Nama_Peserta'],
                order = alt.Order(
                    'Status_Pembayaran',
                    sort = 'ascending'
                    )
                )
                .properties(
                    height=600, width=500, title='Status_Pembayaran ASMIUA'
                )
                .add_selection(
                  selections, selectors
                )
                .transform_filter(
                  selections&selectors
                ) 
            )
          elif df.name == "PD":
            return(
                alt.Chart(A_m)
                .mark_bar()
                .encode(
                y='Kode',
                x='Tgl_Registrasi',
                color = 'Status_Pembayaran',
                tooltip=['Tgl_Registrasi','Status_Pembayaran', 'Kode_Peserta', 'Nama_Peserta'],
                order = alt.Order(
                    'Status_Pembayaran',
                    sort = 'ascending'
                    )
                )
                .properties(
                    height=600, width=500, title='Status_Pembayaran PDSKJI'
                )
                .add_selection(
                    selections, selectors
                )
                .transform_filter(
                    selections&selectors
                ) 
            )
          else:
            return(
                alt.Chart(A_m)
                .mark_bar()
                .encode(
                y='Kode',
                x='Tgl_Registrasi',
                color = 'Status_Pembayaran',
                tooltip=['Tgl_Registrasi','Status_Pembayaran', 'Kode_Peserta', 'Nama_Peserta'],
                order = alt.Order(
                    'Status_Pembayaran',
                    sort = 'ascending'
                    )
                )
                .properties(
                    height=600, width=500, title='Status_Pembayaran PERAPI'
                )
                .add_selection(
                    selections, selectors
                )
                .transform_filter(
                    selections&selectors
                ) 
            )

      ASMIUA_table.value = df_ASMIUA
      PDSKJI_table.value = df_PDSKJI
      PERAPI_table.value = df_PERAPI
      
      bar_A.object = get_bar_(df_ASMIUA)
      bar_PD.object = get_bar_(df_PDSKJI)
      bar_PE.object = get_bar_(df_PERAPI)

      bar_AS.object = get_bar_s(df_ASMIUA)
      bar_PDs.object = get_bar_s(df_PDSKJI)
      bar_PEs.object = get_bar_s(df_PERAPI)
      
      

    
    </py-script>
    
  </body>

</html>
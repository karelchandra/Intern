<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="theme-color" content="#000000">
    <meta name="name" content="Report Based On Operational">

    <title>Operational Report 2019-2022</title>
    <!-- <link rel="icon" type="image/x-icon" href="./favicon.png"> -->

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css" type="text/css" />
    <link rel="stylesheet" href="https://unpkg.com/@holoviz/panel@0.13.1/dist/css/widgets.css" type="text/css" />
    <link rel="stylesheet" href="https://unpkg.com/@holoviz/panel@0.13.1/dist/css/markdown.css" type="text/css" />

    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/vega@5.22.1"></script>
    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/vega-lite@5.5.0"></script>
    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/vega-embed@6.21.0"></script>
    <script type="text/javascript" src="https://unpkg.com/tabulator-tables@4.9.3/dist/js/tabulator.js"></script>
    <script type="text/javascript" src="https://cdn.bokeh.org/bokeh/release/bokeh-2.4.3.js"></script>
    <script type="text/javascript" src="https://cdn.bokeh.org/bokeh/release/bokeh-widgets-2.4.3.min.js"></script>
    <script type="text/javascript" src="https://cdn.bokeh.org/bokeh/release/bokeh-tables-2.4.3.min.js"></script>
    <script type="text/javascript" src="https://unpkg.com/@holoviz/panel@0.13.1/dist/panel.min.js"></script>
    <script type="text/javascript">
      Bokeh.set_log_level("info");
    </script>

    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://unpkg.com/@holoviz/panel@0.13.1/dist/bundled/bootstraptemplate/bootstrap.css">
    <link rel="stylesheet" href="https://unpkg.com/@holoviz/panel@0.13.1/dist/bundled/defaulttheme/default.css">
    <link rel="stylesheet" href="https://www.w3schools.com/w3css/4/w3.css">
    <link rel="stylesheet" href="https://www.w3schools.com/lib/w3-theme-black.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">

    <style>
      #sidebar {
        width: 350px;
      }
      .w3-sidebar {
        z-index: 3;
        width: 250px;
        top: 43px;
        bottom: 0;
        height: inherit; 
      }
      .box div {
        width: 100px;
        display: inline-block;
        padding: 1rem 1rem;
        vertical-align: middle;
      }


    </style>

    <script src="https://cdn.jsdelivr.net/npm/jquery@3.5.1/dist/jquery.slim.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/js/bootstrap.bundle.min.js"></script>

    <link rel="stylesheet" href="https://pyscript.net/latest/pyscript.css" />
    <script defer src="https://pyscript.net/latest/pyscript.js"></script>
  </head>

  <py-config>
    packages = [
      "altair",
      "pandas",
      "numpy",
      "scikit-learn",
      "panel==0.13.1",
      "matplotlib"
    ]
  </py-config>

  <body>

    <div class="container-fluid d-flex flex-column vh-100 overflow-hidden" id="container">
      <!-- Side Navigation and Header -->
      <nav class="navbar navbar-expand-md navbar-dark sticky-top shadow w3-blue-grey" id="header">
	
	  <div class="app-header">
	    <a class="w3-xlarge navbar-brand app-logo" href="/">
	    <img src="https://github.com/karelchandra/Intern/blob/main/Pro_Health.png?raw=true" class="app-logo" width = "100" height = "3000">
	    </a>
	  <a class="title" href="" style="color: #efebe3;">Report Analysis</a>
      </div>
      </nav>
  

	  <div class="col mh-100 float-left w3-display-container" id="main">

    <!-- Header -->
    <div class="w3-container-padding-small" style="margin-top:15px" id="showcase">
      <h2 class="w3-xxxlarge" style = "font-weight: bold" id="title"></h2>
      <h1 class="w3-xxlarge w3-text-teal w3-padding-small" style = "font-weight: bold" id="subtitle"></h1>
    </div>

    <header style="font-size:30px;" class="w3-container w3-blue-grey w3-padding-small" id="value_des">
    </header>
    <div class = "box">
      <div class="bk-root" style="margin-top:10px; margin-left: 5%;" id="bar-plot1"></div>
      <div class="bk-root" style="margin-top:10px; margin-left: 41%;" id="bar-plot2"></div>
    </div>

    <div class = "box">
      <div class="bk-root" style="margin-top:10px; margin-left: 5%;" id="bar-plot3"></div>
      <div class="bk-root" style="margin-top:10px; margin-left: 41%;" id="bar-plot4"></div>
    </div>
    
    <header style="font-size:30px;" class="w3-container w3-blue-grey w3-padding-small" id ="cus_des">
    </header>
    <div class="bk-root" style="margin-top:10px; text-align: center;" id="bar-plot5"></div>
    
    <header style="font-size:30px;" class="w3-container w3-blue-grey w3-padding-small" id ="set_des">
    </header>
    <div class="bk-root" style="margin-top:10px; text-align: center;" id="bar-plot6"></div>

    <header style="font-size:30px;" class="w3-container w3-blue-grey w3-padding-small" id ="sys_des">
    </header>
    <div class="bk-root" style="margin-top:10px; text-align: center;" id="bar-plot7"></div>

    <header style="font-size:30px;" class="w3-container w3-blue-grey w3-padding-small" id ="db_des">
    </header>
    <div class="bk-root" style="margin-top:10px; text-align: center;" id="bar-plot8"></div>

    <header style="font-size:30px;" class="w3-container w3-blue-grey w3-padding-small" id ="pb_des">
    </header>
    <div class="bk-root" style="margin-top:10px; text-align: center;" id="bar-plot9"></div>


    
    <header style="font-size:30px;" class="w3-container w3-blue-grey w3-padding-small" id="table_des">
    </header>
    <h4 class="w3-large w3-text-teal w3-padding-small" style = "font-weight: bold" id="Main_data"></h3>
    <div class="bk-root" id="Main_table"></div>
    
        
    <py-script>
      import warnings
      import altair as alt
      import panel as pn
      import pandas as pd
          
      pn.extension('vega')
    
      from pyodide.http import open_url
    
      warnings.simplefilter(action='ignore', category=FutureWarning)
      pn.config.sizing_mode = 'stretch_width'
      
      
      Main_table = pn.widgets.Tabulator(pagination='remote', page_size=10).servable(target='Main_table')
          
          
      bar_va19 = pn.pane.Vega().servable(target='bar-plot1')
      bar_va20 = pn.pane.Vega().servable(target='bar-plot2')
      bar_va21 = pn.pane.Vega().servable(target='bar-plot3')
      bar_va22 = pn.pane.Vega().servable(target='bar-plot4')
      bar_or = pn.pane.Vega().servable(target='bar-plot5')
      bar_s = pn.pane.Vega().servable(target='bar-plot6')
      bar_sys = pn.pane.Vega().servable(target='bar-plot7')
      bar_db = pn.pane.Vega().servable(target='bar-plot8')
      bar_pb = pn.pane.Vega().servable(target='bar-plot9')

          
      title = pn.pane.Markdown("""Operational Report""").servable(target='title')
      subtitle = pn.pane.Markdown("""2019-2022""").servable(target='subtitle')
      table_des = pn.pane.Markdown("""Provided Dataset""").servable(target='table_des')
          
      Main_data = pn.pane.Markdown("""Main Dataset""").servable(target='Main_data')
      value_des = pn.pane.Markdown("""Analysis of Successful Transactions per Month""").servable(target='value_des')
      customer_des = pn.pane.Markdown("""Analysis of Successful Orders per Month""").servable(target='cus_des')
      set_des = pn.pane.Markdown("""Analysis of Set Group per Month""").servable(target='set_des')
      sys_des = pn.pane.Markdown("""Analysis of System used per Transactions""").servable(target='sys_des')
      db_des = pn.pane.Markdown("""Analysis of Most Deliver""").servable(target='db_des')
      pb_des = pn.pane.Markdown("""Analysis of Most Pickup""").servable(target='pb_des')

      df1 = pd.read_csv(open_url('https://raw.githubusercontent.com/karelchandra/Intern/main/test.csv'), sep=";")
      df1.columns = df1.columns.str.replace(' ', '_')
      df1["Date_Faktur"] = df1["Date_Faktur"].replace(['2021-11-00'],'01/11/21')


      Faktur = df1[df1.Date_Faktur != '-']
      Ft_copy = Faktur.copy()
      Ft_copy['Date_Faktur'] = pd.to_datetime(Ft_copy['Date_Faktur'])
      Ft_copy['Year'] = Ft_copy['Date_Faktur'].dt.strftime('%Y')
      F19 = Ft_copy[Ft_copy.Year == '2019']
      F19.name = '2019'
      F20 = Ft_copy[Ft_copy.Year == '2020']
      F20.name = '2020'
      F21 = Ft_copy[Ft_copy.Year == '2021']
      F21.name = '2021'
      F22 = Ft_copy[Ft_copy.Year == '2022']
      F22.name = '2022'
           
    
      selection = alt.selection_single(fields=['Item_Type'], bind='legend')
      selector = alt.selection_single(fields=['Item_Type'])

      selection_o = alt.selection_single(fields=['Hospital_Name'], bind='legend')
      selector_o = alt.selection_single(fields=['Hospital_Name'])

      selection_s = alt.selection_single(fields=['Set_Group'], bind='legend')
      selector_s = alt.selection_single(fields=['Set_Group'])

      selection_sy = alt.selection_single(fields=['System'], bind='legend')
      selector_sy = alt.selection_single(fields=['System'])

      selection_db = alt.selection_single(fields=['Deliver_By'], bind='legend')
      selector_db = alt.selection_single(fields=['Deliver_By'])
      
      selection_pb = alt.selection_single(fields=['Pickup_By'], bind='legend')
      selector_pb = alt.selection_single(fields=['Pickup_By'])

      def get_bar_value(df):
          A_copy = df.copy()
          A_copy['Date_Faktur'] = pd.to_datetime(A_copy['Date_Faktur'])
          A_m = A_copy.groupby([A_copy['Date_Faktur'], A_copy['Id_Orders'], A_copy['Item_Type'], A_copy['Order_By'], A_copy['Hospital_Name']])['Total_Faktur'].sum()
          A_m = A_m.reset_index()   
          A_m['Date_Faktur'] = A_m['Date_Faktur'].dt.strftime('%Y-%m')
          return(
            alt.Chart(A_m)
            .mark_bar()
            .encode(
              y='Total_Faktur',
              x='Date_Faktur',
              color = 'Item_Type',
              tooltip=[alt.Tooltip('Total_Faktur',format=",.2f"), 'Order_By', 'Hospital_Name'],
              order = alt.Order(
                'Id_Orders',
                sort = 'ascending'
              )
            )
            .properties(
              height=600, width=500, title="Total Faktur"
            )
            .add_selection(
              selection, selector
            )
            .transform_filter(
              selection&selector
            ) 
          )
          
      def get_bar_order(df):
          A_copy = df.copy()
          A_copy1 = A_copy.copy()
          A_copy['Request_Date'] = pd.to_datetime(A_copy['Request_Date'])
          A_copy1['Request_Date'] = pd.to_datetime(A_copy1['Request_Date'])
          A_copy['Year'] = A_copy1['Request_Date'].dt.strftime('%Y')          
          A_m = A_copy.groupby([A_copy['Request_Date'], A_copy['Hospital_Name'], A_copy['Order_By'], A_copy['Via'], A_copy['Year']])['Id_Orders'].count()
          A_m = A_m.reset_index()   
          A_m['Request_Date'] = A_m['Request_Date'].dt.strftime('%Y-%m')
          d19 = A_m[A_m.Year == '2019']
          d20 = A_m[A_m.Year == '2020']
          d21 = A_m[A_m.Year == '2021']
          d22 = A_m[A_m.Year == '2022']
          upper1 = alt.Chart(d19).mark_bar().encode(
            y='Id_Orders',
            x='Request_Date',
            color= alt.Color('Hospital_Name', scale=alt.Scale(scheme='tableau20')),
            tooltip=[alt.Tooltip('Id_Orders',format=",.2f"), 'Hospital_Name', 'Order_By', 'Via'],
            order = alt.Order(
              'Id_Orders',
              sort = 'ascending'
            )
          ).properties(
            height=600, width=500, title="Total Order 2019"
          ).add_selection(
            selection_o, selector_o
          ).transform_filter(
            selection_o&selector_o
          )
          upper2 = alt.Chart(d20).mark_bar().encode(
            y='Id_Orders',
            x='Request_Date',
            color= alt.Color('Hospital_Name', scale=alt.Scale(scheme='tableau20')),
            tooltip=[alt.Tooltip('Id_Orders',format=",.2f"), 'Hospital_Name', 'Order_By', 'Via'],
            order = alt.Order(
              'Id_Orders',
              sort = 'ascending'
            )
          ).properties(
            height=600, width=500, title="Total Order 2020"
          ).add_selection(
            selection_o, selector_o
          ).transform_filter(
            selection_o&selector_o
          )
          lower1 = alt.Chart(d21).mark_bar().encode(
            y='Id_Orders',
            x='Request_Date',
            color= alt.Color('Hospital_Name', legend=alt.Legend(symbolLimit=300,columns=3), scale=alt.Scale(scheme='tableau20')),
            tooltip=[alt.Tooltip('Id_Orders',format=",.2f"), 'Hospital_Name', 'Order_By', 'Via'],
            order = alt.Order(
              'Id_Orders',
              sort = 'ascending'
            )
          ).properties(
            height=600, width=500, title="Total Order 2021"
          ).add_selection(
            selection_o, selector_o
          ).transform_filter(
            selection_o&selector_o
          )
          lower2 = alt.Chart(d22).mark_bar().encode(
            y='Id_Orders',
            x='Request_Date',
            color= alt.Color('Hospital_Name', scale=alt.Scale(scheme='tableau20')),
            tooltip=[alt.Tooltip('Id_Orders',format=",.2f"), 'Hospital_Name', 'Order_By', 'Via'],
            order = alt.Order(
              'Id_Orders',
              sort = 'ascending'
            )
          ).properties(
            height=600, width=500, title="Total Order 2022"
          ).add_selection(
            selection_o, selector_o
          ).transform_filter(
            selection_o&selector_o
          )
          return(
            alt.vconcat((upper1 | upper2), (lower1 | lower2))
          )

      def get_bar_set(df):
          A_copy = df.copy()
          A_copy1 = A_copy.copy()
          A_copy['Request_Date'] = pd.to_datetime(A_copy['Request_Date'])
          A_copy1['Request_Date'] = pd.to_datetime(A_copy1['Request_Date'])
          A_copy['Year'] = A_copy1['Request_Date'].dt.strftime('%Y')          
          A_m = A_copy.groupby([A_copy['Request_Date'], A_copy['Hospital_Name'], A_copy['Order_By'], A_copy['Via'], A_copy['Year'], A_copy['Set_Group']])['Id_Orders'].count()
          A_m = A_m.reset_index()   
          A_m['Request_Date'] = A_m['Request_Date'].dt.strftime('%Y-%m')
          d19 = A_m[A_m.Year == '2019']
          d20 = A_m[A_m.Year == '2020']
          d21 = A_m[A_m.Year == '2021']
          d22 = A_m[A_m.Year == '2022']
          upper1 = alt.Chart(d19).mark_bar().encode(
            y='Id_Orders',
            x='Request_Date',
            color= alt.Color('Set_Group', scale=alt.Scale(scheme='tableau20')),
            tooltip=[alt.Tooltip('Id_Orders',format=",.2f"), 'Hospital_Name', 'Order_By', 'Via', 'Set_Group'],
            order = alt.Order(
              'Id_Orders',
              sort = 'ascending'
            )
          ).properties(
            height=600, width=500, title="Total Order 2019"
          ).add_selection(
            selection_s, selector_s
          ).transform_filter(
            selection_s&selector_s
          )
          upper2 = alt.Chart(d20).mark_bar().encode(
            y='Id_Orders',
            x='Request_Date',
            color= alt.Color('Set_Group', scale=alt.Scale(scheme='tableau20')),
            tooltip=[alt.Tooltip('Id_Orders',format=",.2f"), 'Hospital_Name', 'Order_By', 'Via', 'Set_Group'],
            order = alt.Order(
              'Id_Orders',
              sort = 'ascending'
            )
          ).properties(
            height=600, width=500, title="Total Order 2020"
          ).add_selection(
            selection_s, selector_s
          ).transform_filter(
            selection_s&selector_s
          )
          lower1 = alt.Chart(d21).mark_bar().encode(
            y='Id_Orders',
            x='Request_Date',
            color= alt.Color('Set_Group', scale=alt.Scale(scheme='tableau20')),
            tooltip=[alt.Tooltip('Id_Orders',format=",.2f"), 'Hospital_Name', 'Order_By', 'Via', 'Set_Group'],
            order = alt.Order(
              'Id_Orders',
              sort = 'ascending'
            )
          ).properties(
            height=600, width=500, title="Total Order 2021"
          ).add_selection(
            selection_s, selector_s
          ).transform_filter(
            selection_s&selector_s
          )
          lower2 = alt.Chart(d22).mark_bar().encode(
            y='Id_Orders',
            x='Request_Date',
            color= alt.Color('Set_Group', scale=alt.Scale(scheme='tableau20')),
            tooltip=[alt.Tooltip('Id_Orders',format=",.2f"), 'Hospital_Name', 'Order_By', 'Via', 'Set_Group'],
            order = alt.Order(
              'Id_Orders',
              sort = 'ascending'
            )
          ).properties(
            height=600, width=500, title="Total Order 2022"
          ).add_selection(
            selection_s, selector_s
          ).transform_filter(
            selection_s&selector_s
          )
          return(
            alt.vconcat((upper1 | upper2), (lower1 | lower2))
          )

      def get_bar_sys(df):
          A_copy = df.copy()
          A_copy1 = A_copy.copy()
          A_copy['Request_Date'] = pd.to_datetime(A_copy['Request_Date'])
          A_copy1['Request_Date'] = pd.to_datetime(A_copy1['Request_Date'])
          A_copy['Year'] = A_copy1['Request_Date'].dt.strftime('%Y')          
          A_m = A_copy.groupby([A_copy['Request_Date'], A_copy['Hospital_Name'], A_copy['Order_By'], A_copy['Via'], A_copy['Year'], A_copy['System']])['Id_Orders'].count()
          A_m = A_m.reset_index()   
          A_m['Request_Date'] = A_m['Request_Date'].dt.strftime('%Y-%m')
          d19 = A_m[A_m.Year == '2019']
          d20 = A_m[A_m.Year == '2020']
          d21 = A_m[A_m.Year == '2021']
          d22 = A_m[A_m.Year == '2022']
          upper1 = alt.Chart(d19).mark_bar().encode(
            y='Id_Orders',
            x='Request_Date',
            color= alt.Color('System', legend=alt.Legend(symbolLimit=100), scale=alt.Scale(scheme='tableau20')),
            tooltip=[alt.Tooltip('Id_Orders',format=",.2f"), 'Hospital_Name', 'Order_By', 'Via', 'System'],
            order = alt.Order(
              'Id_Orders',
              sort = 'ascending'
            )
          ).properties(
            height=600, width=500, title="Total Order 2019"
          ).add_selection(
            selection_sy, selector_sy
          ).transform_filter(
            selection_sy&selector_sy
          )
          upper2 = alt.Chart(d20).mark_bar().encode(
            y='Id_Orders',
            x='Request_Date',
            color= alt.Color('System', scale=alt.Scale(scheme='tableau20')),
            tooltip=[alt.Tooltip('Id_Orders',format=",.2f"), 'Hospital_Name', 'Order_By', 'Via', 'System'],
            order = alt.Order(
              'Id_Orders',
              sort = 'ascending'
            )
          ).properties(
            height=600, width=500, title="Total Order 2020"
          ).add_selection(
            selection_sy, selector_sy
          ).transform_filter(
            selection_sy&selector_sy
          )
          lower1 = alt.Chart(d21).mark_bar().encode(
            y='Id_Orders',
            x='Request_Date',
            color= alt.Color('System', scale=alt.Scale(scheme='tableau20')),
            tooltip=[alt.Tooltip('Id_Orders',format=",.2f"), 'Hospital_Name', 'Order_By', 'Via', 'System'],
            order = alt.Order(
              'Id_Orders',
              sort = 'ascending'
            )
          ).properties(
            height=600, width=500, title="Total Order 2021"
          ).add_selection(
            selection_sy, selector_sy
          ).transform_filter(
            selection_sy&selector_sy
          )
          lower2 = alt.Chart(d22).mark_bar().encode(
            y='Id_Orders',
            x='Request_Date',
            color= alt.Color('System', scale=alt.Scale(scheme='tableau20')),
            tooltip=[alt.Tooltip('Id_Orders',format=",.2f"), 'Hospital_Name', 'Order_By', 'Via', 'System'],
            order = alt.Order(
              'Id_Orders',
              sort = 'ascending'
            )
          ).properties(
            height=600, width=500, title="Total Order 2022"
          ).add_selection(
            selection_sy, selector_sy
          ).transform_filter(
            selection_sy&selector_sy
          )
          return(
            alt.vconcat((upper1 | upper2), (lower1 | lower2))
          )

      def get_bar_db(df):
          A_copy = df.copy()
          A_copy1 = A_copy.copy()
          A_copy['Request_Date'] = pd.to_datetime(A_copy['Request_Date'])
          A_copy1['Request_Date'] = pd.to_datetime(A_copy1['Request_Date'])
          A_copy['Year'] = A_copy1['Request_Date'].dt.strftime('%Y')          
          A_m = A_copy.groupby([A_copy['Request_Date'], A_copy['Hospital_Name'], A_copy['Order_By'], A_copy['Via'], A_copy['Year'], A_copy['Deliver_By']])['Id_Orders'].count()
          A_m = A_m.reset_index()   
          A_m['Request_Date'] = A_m['Request_Date'].dt.strftime('%Y-%m')
          d19 = A_m[A_m.Year == '2019']
          d20 = A_m[A_m.Year == '2020']
          d21 = A_m[A_m.Year == '2021']
          d22 = A_m[A_m.Year == '2022']
          upper1 = alt.Chart(d19).mark_bar().encode(
            y='Id_Orders',
            x='Request_Date',
            color= alt.Color('Deliver_By', scale=alt.Scale(scheme='tableau20')),
            tooltip=[alt.Tooltip('Id_Orders',format=",.2f"), 'Hospital_Name', 'Order_By', 'Via', 'Deliver_By'],
            order = alt.Order(
              'Id_Orders',
              sort = 'ascending'
            )
          ).properties(
            height=600, width=500, title="Total Order 2019"
          ).add_selection(
            selection_db, selector_db
          ).transform_filter(
            selection_db&selector_db
          )
          upper2 = alt.Chart(d20).mark_bar().encode(
            y='Id_Orders',
            x='Request_Date',
            color= alt.Color('Deliver_By', scale=alt.Scale(scheme='tableau20')),
            tooltip=[alt.Tooltip('Id_Orders',format=",.2f"), 'Hospital_Name', 'Order_By', 'Via', 'Deliver_By'],
            order = alt.Order(
              'Id_Orders',
              sort = 'ascending'
            )
          ).properties(
            height=600, width=500, title="Total Order 2020"
          ).add_selection(
            selection_db, selector_db
          ).transform_filter(
            selection_db&selector_db
          )
          lower1 = alt.Chart(d21).mark_bar().encode(
            y='Id_Orders',
            x='Request_Date',
            color= alt.Color('Deliver_By', scale=alt.Scale(scheme='tableau20')),
            tooltip=[alt.Tooltip('Id_Orders',format=",.2f"), 'Hospital_Name', 'Order_By', 'Via', 'Deliver_By'],
            order = alt.Order(
              'Id_Orders',
              sort = 'ascending'
            )
          ).properties(
            height=600, width=500, title="Total Order 2021"
          ).add_selection(
            selection_db, selector_db
          ).transform_filter(
            selection_db&selector_db
          )
          lower2 = alt.Chart(d22).mark_bar().encode(
            y='Id_Orders',
            x='Request_Date',
            color= alt.Color('Deliver_By', scale=alt.Scale(scheme='tableau20')),
            tooltip=[alt.Tooltip('Id_Orders',format=",.2f"), 'Hospital_Name', 'Order_By', 'Via', 'Deliver_By'],
            order = alt.Order(
              'Id_Orders',
              sort = 'ascending'
            )
          ).properties(
            height=600, width=500, title="Total Order 2022"
          ).add_selection(
            selection_db, selector_db
          ).transform_filter(
            selection_db&selector_db
          )
          return(
            alt.vconcat((upper1 | upper2), (lower1 | lower2))
          )

      def get_bar_pb(df):
          A_copy = df.copy()
          A_copy1 = A_copy.copy()
          A_copy['Request_Date'] = pd.to_datetime(A_copy['Request_Date'])
          A_copy1['Request_Date'] = pd.to_datetime(A_copy1['Request_Date'])
          A_copy['Year'] = A_copy1['Request_Date'].dt.strftime('%Y')          
          A_m = A_copy.groupby([A_copy['Request_Date'], A_copy['Hospital_Name'], A_copy['Order_By'], A_copy['Via'], A_copy['Year'], A_copy['Pickup_By']])['Id_Orders'].count()
          A_m = A_m.reset_index()   
          A_m['Request_Date'] = A_m['Request_Date'].dt.strftime('%Y-%m')
          d19 = A_m[A_m.Year == '2019']
          d20 = A_m[A_m.Year == '2020']
          d21 = A_m[A_m.Year == '2021']
          d22 = A_m[A_m.Year == '2022']
          upper1 = alt.Chart(d19).mark_bar().encode(
            y='Id_Orders',
            x='Request_Date',
            color= alt.Color('Pickup_By', scale=alt.Scale(scheme='tableau20')),
            tooltip=[alt.Tooltip('Id_Orders',format=",.2f"), 'Hospital_Name', 'Order_By', 'Via', 'Pickup_By'],
            order = alt.Order(
              'Id_Orders',
              sort = 'ascending'
            )
          ).properties(
            height=600, width=500, title="Total Order 2019"
          ).add_selection(
            selection_pb, selector_pb
          ).transform_filter(
            selection_pb&selector_pb
          )
          upper2 = alt.Chart(d20).mark_bar().encode(
            y='Id_Orders',
            x='Request_Date',
            color= alt.Color('Pickup_By', scale=alt.Scale(scheme='tableau20')),
            tooltip=[alt.Tooltip('Id_Orders',format=",.2f"), 'Hospital_Name', 'Order_By', 'Via', 'Pickup_By'],
            order = alt.Order(
              'Id_Orders',
              sort = 'ascending'
            )
          ).properties(
            height=600, width=500, title="Total Order 2020"
          ).add_selection(
            selection_pb, selector_pb
          ).transform_filter(
            selection_pb&selector_pb
          )
          lower1 = alt.Chart(d21).mark_bar().encode(
            y='Id_Orders',
            x='Request_Date',
            color= alt.Color('Pickup_By', scale=alt.Scale(scheme='tableau20')),
            tooltip=[alt.Tooltip('Id_Orders',format=",.2f"), 'Hospital_Name', 'Order_By', 'Via', 'Pickup_By'],
            order = alt.Order(
              'Id_Orders',
              sort = 'ascending'
            )
          ).properties(
            height=600, width=500, title="Total Order 2021"
          ).add_selection(
            selection_pb, selector_pb
          ).transform_filter(
            selection_pb&selector_pb
          )
          lower2 = alt.Chart(d22).mark_bar().encode(
            y='Id_Orders',
            x='Request_Date',
            color= alt.Color('Pickup_By', scale=alt.Scale(scheme='tableau20')),
            tooltip=[alt.Tooltip('Id_Orders',format=",.2f"), 'Hospital_Name', 'Order_By', 'Via', 'Pickup_By'],
            order = alt.Order(
              'Id_Orders',
              sort = 'ascending'
            )
          ).properties(
            height=600, width=500, title="Total Order 2022"
          ).add_selection(
            selection_pb, selector_pb
          ).transform_filter(
            selection_pb&selector_pb
          )
          return(
            alt.vconcat((upper1 | upper2), (lower1 | lower2))
          )

      Main_table.value = df1   
      bar_va19.object = get_bar_value(F19)
      bar_va20.object = get_bar_value(F20)
      bar_va21.object = get_bar_value(F21)
      bar_va22.object = get_bar_value(F22)

      bar_or.object = get_bar_order(df1)
      bar_s.object = get_bar_set(df1)
      bar_sys.object = get_bar_sys(df1)
      bar_db.object = get_bar_db(df1)
      bar_pb.object = get_bar_pb(df1)

    
         
    </py-script>
    
  </body>

</html>

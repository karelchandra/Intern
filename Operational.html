<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta name="apple-mobile-web-app-capable" content="yes">
        <meta name="apple-mobile-web-app-status-bar-style" content="default">
        <meta name="theme-color" content="#000000">
        <meta name="name" content="Sales Based on CBV">
    
        <title>Sales Report 2021-2020</title>
        <!-- <link rel="icon" type="image/x-icon" href="./favicon.png"> -->
    
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css" type="text/css" />
        <link rel="stylesheet" href="https://unpkg.com/@holoviz/panel@0.13.1/dist/css/widgets.css" type="text/css" />
        <link rel="stylesheet" href="https://unpkg.com/@holoviz/panel@0.13.1/dist/css/markdown.css" type="text/css" />
    
        <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/vega@5.22.1"></script>
        <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/vega-lite@5.5.0"></script>
        <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/vega-embed@6.21.0"></script>
        <script type="text/javascript" src="https://unpkg.com/tabulator-tables@4.9.3/dist/js/tabulator.js"></script>
        <script type="text/javascript" src="https://cdn.bokeh.org/bokeh/release/bokeh-2.4.3.js"></script>
        <script type="text/javascript" src="https://cdn.bokeh.org/bokeh/release/bokeh-widgets-2.4.3.min.js"></script>
        <script type="text/javascript" src="https://cdn.bokeh.org/bokeh/release/bokeh-tables-2.4.3.min.js"></script>
        <script type="text/javascript" src="https://unpkg.com/@holoviz/panel@0.13.1/dist/panel.min.js"></script>
        <script type="text/javascript">
          Bokeh.set_log_level("info");
        </script>
    
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/css/bootstrap.min.css">
        <link rel="stylesheet" href="https://unpkg.com/@holoviz/panel@0.13.1/dist/bundled/bootstraptemplate/bootstrap.css">
        <link rel="stylesheet" href="https://unpkg.com/@holoviz/panel@0.13.1/dist/bundled/defaulttheme/default.css">
        <link rel="stylesheet" href="https://www.w3schools.com/w3css/4/w3.css">
        <link rel="stylesheet" href="https://www.w3schools.com/lib/w3-theme-black.css">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    
        <style>
          #sidebar {
            width: 350px;
          }
          .w3-sidebar {
            z-index: 3;
            width: 250px;
            top: 43px;
            bottom: 0;
            height: inherit; 
          }
          .box div {
            width: 100px;
            display: inline-block;
            padding: 1rem 1rem;
            vertical-align: middle;
          }
    
    
        </style>
    
        <script src="https://cdn.jsdelivr.net/npm/jquery@3.5.1/dist/jquery.slim.min.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/js/bootstrap.bundle.min.js"></script>
    
        <link rel="stylesheet" href="https://pyscript.net/latest/pyscript.css" />
        <script defer src="https://pyscript.net/latest/pyscript.js"></script>
    </head>

    <py-config>
        packages = [
          "altair",
          "pandas",
          "numpy",
          "scikit-learn",
          "panel==0.13.1",
          "matplotlib"
        ]
    </py-config>

    <body>
        <div class="container-fluid d-flex flex-column vh-100 overflow-hidden" id="container">
          <!-- Side Navigation and Header -->
          <nav class="navbar navbar-expand-md navbar-dark sticky-top shadow w3-blue-grey" id="header">
        
        <div class="app-header">
          <a class="w3-xlarge navbar-brand app-logo" href="/">
            <img src="https://github.com/karelchandra/Intern/blob/main/Pro_Health.png?raw=true" class="app-logo" width = "100" height = "3000">
          </a>
          <a class="title" href="" style="color: #efebe3;">Report Analysis</a>
          </div>
          </nav>
      
    
        <div class="col mh-100 float-left w3-display-container" id="main">
    
        <!-- Header -->
        <div class="w3-container-padding-small" style="margin-top:15px" id="showcase">
            <h2 class="w3-xxxlarge" style = "font-weight: bold" id="title"></h2>
            <h1 class="w3-xxlarge w3-text-teal w3-padding-small" style = "font-weight: bold" id="subtitle"></h1>
        </div>
    
        <header style="font-size:30px;" class="w3-container w3-blue-grey w3-padding-small" id="value_des">
        </header>
        <div class="bk-root" style="margin-top:10px; text-align: center;" id="bar-plot1"></div>
        <div class="bk-root" style="margin-top:10px; text-align: center;" id="bar-plot2"></div>
        <div class="bk-root" style="margin-top:10px; text-align: center;" id="bar-plot3"></div>
      
    
        <header style="font-size:30px;" class="w3-container w3-blue-grey w3-padding-small" id ="cus_des">
        </header>
        <div class="bk-root" style="margin-top:10px; text-align: center;" id="bar-plot4"></div>
        <div class="bk-root" style="margin-top:10px; text-align: center;" id="bar-plot5"></div>
        <div class="bk-root" style="margin-top:10px; text-align: center;" id="bar-plot6"></div>
    
    
        <header style="font-size:30px;" class="w3-container w3-blue-grey w3-padding-small" id="region_des">
        </header>
        <div class="bk-root" style="margin-top:10px; text-align: center;" id="bar-plot7"></div>
        <div class="bk-root" style="margin-top:10px; text-align: center;" id="bar-plot8"></div>
        <div class="bk-root" style="margin-top:10px; text-align: center;" id="bar-plot9"></div>
          
    
        <header style="font-size:30px;" class="w3-container w3-blue-grey w3-padding-small" id="table_des">
        </header>
        <h4 class="w3-large w3-text-teal w3-padding-small" style = "font-weight: bold" id="Main_data"></h3>
        <div class="bk-root" id="Main_table"></div>
        

        
        <py-script>
            import warnings
            import altair as alt
            import panel as pn
            import pandas as pd
          
            pn.extension('vega')
    
            from pyodide.http import open_url
    
            warnings.simplefilter(action='ignore', category=FutureWarning)
            pn.config.sizing_mode = 'stretch_width'
      
            df1 = pd.read_csv(open_url('https://raw.githubusercontent.com/karelchandra/Intern/main/test.csv'), sep=";")
            df1.columns = df1.columns.str.replace(' ', '_')
    
         
            Main_table = pn.widgets.Tabulator(pagination='remote', page_size=10).servable(target='Main_table')
          
          
          
            bar_vax = pn.pane.Vega().servable(target='bar-plot1')
            bar_val = pn.pane.Vega().servable(target='bar-plot2')
            bar_vae = pn.pane.Vega().servable(target='bar-plot3')
          
            bar_vaxcs = pn.pane.Vega().servable(target='bar-plot4')
            bar_valcs = pn.pane.Vega().servable(target='bar-plot5')
            bar_vaecs = pn.pane.Vega().servable(target='bar-plot6')
    
            bar_regax = pn.pane.Vega().servable(target='bar-plot7')
            bar_regal = pn.pane.Vega().servable(target='bar-plot8')
            bar_regae = pn.pane.Vega().servable(target='bar-plot9')
    
    
            title = pn.pane.Markdown("""Operational Report""").servable(target='title')
            subtitle = pn.pane.Markdown("""2019-2022""").servable(target='subtitle')
            table_des = pn.pane.Markdown("""Provided Dataset""").servable(target='table_des')
          
            Main_data = pn.pane.Markdown("""Main Dataset""").servable(target='Main_data')
            value_des = pn.pane.Markdown("""Analysis of Successful Transactions by sales per Month""").servable(target='value_des')
            customer_des = pn.pane.Markdown("""Analysis of Transactions by Customer per Month""").servable(target='cus_des')
            region_des = pn.pane.Markdown("""Analysis of Transactions by Region per Month""").servable(target='region_des')
          
            
    
            selection = alt.selection_single(fields=['Item_Type'], bind='legend')
            selector = alt.selection_single(fields=['Item_Type'])
    
            selection_c = alt.selection_single(fields=['nama_customer'], bind='legend')
            selector_c = alt.selection_single(fields=['nama_customer'])
    
            selection_r = alt.selection_single(fields=['region'], bind='legend')
            selector_r = alt.selection_single(fields=['region'])
          
            def get_bar_value(df):
                A_copy = df.copy()
                A_copy['Date_Faktur'] = pd.to_datetime(A_copy['Date_Faktur'])
                A_m = A_copy.groupby([A_copy['Date_Faktur'], A_copy['Id_Orders'], A_copy['Item_Type']])['Total_Faktur'].sum()
                A_m = A_m.reset_index()   
                A_m['Date_Faktur'] = A_m['Date_Faktur'].dt.to_timestamp('s').dt.strftime('%Y-%m')
                return(
                    alt.Chart(A_m)
                    .mark_bar()
                    .encode(
                        y='Total_Faktur',
                        color= alt.Color('Item_Type', legend=alt.Legend(symbolLimit=90), scale=alt.Scale(scheme='tableau20')),
                        x='Date_Faktur',
                        tooltip=[alt.Tooltip('Total_Faktur',format=",.2f")],
                        order = alt.Order(
                        'Total_Faktur',
                        sort = 'ascending'
                        )
                    )
                    .properties(
                        height=600, width=500, title="Total Faktur Chart"
                    )
                    .add_selection(
                        selection, selector
                    )
                    .transform_filter(
                        selection&selector
                    )
                )

            Main_table.value = df1   
            bar_vax.object = get_bar_value(df1)
         
        </py-script>
    
      </body>

</html>
